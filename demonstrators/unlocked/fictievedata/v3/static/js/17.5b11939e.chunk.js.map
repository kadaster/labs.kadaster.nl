{"version":3,"sources":["../node_modules/web-ifc-three/node_modules/web-ifc sync","components/widgets/bb/ifc/BBThreeJSViewer.module.css","../node_modules/openbim-components/node_modules/web-ifc sync","components/widgets/bb/ifc/IFCGLBFile.js","components/widgets/bb/ifc/IFCFile.js","components/widgets/bb/ifc/IFCDBSparql.js","components/widgets/bb/ifc/IFCDB.js","components/widgets/bb/ifc/ThreeJSViewer.js","components/widgets/bb/ifc/BBThreeJSViewer.js"],"names":["webpackEmptyContext","req","e","Error","code","keys","resolve","module","exports","id","IFCGLBFile","ifcdb","file","rv","simpleMode","name","gltf","visible","allBFGs","allNodes","allFirstChild","allFirstMaterial","loading","defaultChilds","MANAGER","LoadingManager","THREE_PATH","REVISION","DRACO_LOADER","DRACOLoader","setDecoderPath","KTX2_LOADER","KTX2Loader","setTranscoderPath","Cache","enabled","this","loader","GLTFLoader","setCrossOrigin","setMeshoptDecoder","MeshoptDecoder","setDRACOLoader","setKTX2Loader","detectSupport","viewer","renderer","setWithCredentials","manager","setResourcePath","me","console","log","loadAsync","then","needsTranslation","processGLTF","getCenter","call","progress","error","window","alert","catch","err","Box3","setFromObject","scene","Vector3","center","Math","abs","x","y","z","rootGroup","add","guid","n","child","ncenter","resetMatrix","children","processGLTFElement","matrix","Matrix4","matrixWorld","parent","isMesh","isObject3D","geometry","length","isBufferGeometry","cid","color","r","b","g","material","ar","updateMatrix","updateMatrixWorld","sub","clone","matrixT","makeTranslation","multiply","applyMatrix4","push","aantal","subAantal","colorMat","key","mat2","mat","getDefaultColor","processColoring","IFCFile","root","IFCLoader","ifcManager","setWasmPath","wasmLoaded","loadReallyIFC","load","mesh","groups","IFCDBSparql","guid_label","latestData","guid_color","props","data","results","bindings","binding","value","label","startsWith","stringToColour","str","hash","i","charCodeAt","colour","toString","substr","c","hex","componentToHex","fn","ifcfiles","ifc","visualize","colorString","getColor","MeshPhysicalMaterial","vertexColors","cchild2","Mesh","zoomAt","defaultColor","loadingInProgress","processSparqlResults","amoutOfSparqlResults","setSparqlColors_double","setSparqlColors_ReOrganise","IFCDB","onlyOnce","pickGroup","inputChanged","ifcdbsparql","latestBindings","selectOnlySparqlResults","tx","ty","tz","reusepickgroup","updateRender","emptyScene","useSparqlColors","setSparqlColors","createNewPickGroup","controls","update","setSelectedGuid","setAnimeerAantal","setLoading","top","translateIntoView","onlyOnceTranslationDebug","processedAll","aabb","getSize","defaultMat","hint","fog","transparent","opacity","MeshPhongMaterial","shininess","emissiveIntensity","lightMapIntensity","emissive","MeshToonMaterial","depthWrite","addDefaultToScene","colorHash","rar","BufferGeometryUtils","matrixAutoUpdate","castShadow","receiveShadow","Group","getNewRootGroup","getDefaultScene","ifcguid","updateWorldMatrix","files","nfile","f","getIFCFile","includes","ifcFile","getChild","createNewScene","orbiting","asyncLoadGLBFiles","slice","loadedfiles","reset","setVisible","loadingNewFiles","toLowerCase","endsWith","readyLoading","processBindings","lm","tobeprocessedBindings","aantalBindings","gltfB","JSON","parse","uri","userData","ThreeJSViewer","raycaster","camera","pointer","Vector2","selectedChild","hooverChild","threeCanvas","animeerAantal","target","distance","size","gsap","to","position","duration","onUpdate","lookAt","orbitControls","onComplete","tcid","document","getElementById","components","OBC","init","get","directionalLight","DirectionalLight","set","intensity","ambientLight","AmbientLight","grid","tools","Raycaster","canvasBounds","getBoundingClientRect","width","right","left","height","bottom","Scene","aspect","PerspectiveCamera","near","far","pointLight","PointLight","background","Color","WebGLRenderer","canvas","alpha","powerPreference","antialias","logarithmicDepthBuffer","sortObjects","colorManagement","setPixelRatio","devicePixelRatio","setSize","GridHelper","axes","AxesHelper","depthTest","renderOrder","OrbitControls","enableDamping","animate","render","requestAnimationFrame","addEventListener","event","mousemove","mouseclick","mouseDoubleClick","updateProjectionMatrix","clear","lightColor","light","HemisphereLight","SpotLight","resize","preventDefault","getContext","clientX","clientY","pg","getPickGroup","setFromCamera","intersectObjects","intersects","getIntersection","object","orgMatrix","orgMaterial","specular","remove","msg","getLabel","showTippy","destroyTippy","newGuid","pubsub","guidselector","selectedGuid","par","publish","showSelectChild","tippy","div","trigger","placement","plugins","followCursor","content","setContent","show","hide","boundingBox","fov","PI","fovh","atan","tan","dx","dy","cameraZ","max","minZ","min","cameraToFarEdge","undefined","maxDistance","BBThreeJSViewer","canvasDiv","React","createRef","onResize","currentCanvasDiv","current","ResizeObserver","entries","observe","initViewer","ready","prefix","files2","file2","PublishUtils","processStringForParameters","files22","split","nn","file3","replace","state","a1","getGLBFilesFromProps","a2","stringify","sel","sel2","sela","loadIFC","ifcLoader","ifcModel","force","isEmpty","shouldLoadNewFiles","loadGLBFiles","needsUpdate","idN","tippyID","ref","className","styles","fullWidget","src","gearWhite","alt","onClick","setState","dialogVisible","style","Component","connect"],"mappings":"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","file":"static/js/17.5b11939e.chunk.js","sourcesContent":["function webpackEmptyContext(req) {\n\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\te.code = 'MODULE_NOT_FOUND';\n\tthrow e;\n}\nwebpackEmptyContext.keys = function() { return []; };\nwebpackEmptyContext.resolve = webpackEmptyContext;\nmodule.exports = webpackEmptyContext;\nwebpackEmptyContext.id = 1149;","// extracted by mini-css-extract-plugin\nmodule.exports = {\"fullWidget\":\"BBThreeJSViewer_fullWidget__16tbM\",\"right\":\"BBThreeJSViewer_right__35Xyd\",\"drawer\":\"BBThreeJSViewer_drawer__2Omkl\"};","function webpackEmptyContext(req) {\n\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\te.code = 'MODULE_NOT_FOUND';\n\tthrow e;\n}\nwebpackEmptyContext.keys = function() { return []; };\nwebpackEmptyContext.resolve = webpackEmptyContext;\nmodule.exports = webpackEmptyContext;\nwebpackEmptyContext.id = 1155;","import { ConstructionOutlined } from \"@mui/icons-material\";\r\nimport {Box3,Cache,Object3D,Vector3, REVISION,Matrix4,BufferGeometry,LoadingManager } from \"three\";\r\nimport { GLTFLoader } from 'three/examples/jsm/loaders/GLTFLoader'\r\nimport { KTX2Loader } from 'three/examples/jsm/loaders/KTX2Loader.js';\r\nimport { DRACOLoader } from 'three/examples/jsm/loaders/DRACOLoader.js';\r\n\r\nimport { MeshoptDecoder } from 'three/examples/jsm/libs/meshopt_decoder.module.js';\r\n\r\nclass IFCGLBFile\r\n{\r\n    ifcdb=null;\r\n    name=null;\r\n    gltf =null;\r\n    visible=true;\r\n    allBFGs={};\r\n    allNodes=[];\r\n    allFirstChild={}\r\n    allFirstMaterial={};\r\n    loading=null;\r\n    defaultChilds=null;\r\n\r\n    simpleMode=false;\r\n\r\n\r\n\r\n  \r\n\r\n  //  size={};\r\n   // center={};\r\n\r\n   \r\nconstructor(ifcdb,file,rv,simpleMode)\r\n{\r\n  const MANAGER = new LoadingManager();\r\n  const THREE_PATH = `https://unpkg.com/three@0.${REVISION}.x`\r\n  const DRACO_LOADER = new DRACOLoader( MANAGER ).setDecoderPath( `${THREE_PATH}/examples/jsm/libs/draco/gltf/` );\r\n  const KTX2_LOADER = new KTX2Loader( MANAGER ).setTranscoderPath( `${THREE_PATH}/examples/jsm/libs/basis/` );\r\n  Cache.enabled = true;\r\n  this.ifcdb=ifcdb;\r\n  //Object3D.DefaultUp.set(0, 0, 1);\r\n  if (simpleMode==true) {this.simpleMode=true;}\r\n  var loader = new GLTFLoader();\r\n  loader.setCrossOrigin('anonymous');\r\n  loader.setMeshoptDecoder( MeshoptDecoder );\r\n  loader.setDRACOLoader( DRACO_LOADER )\r\n  loader.setKTX2Loader( KTX2_LOADER.detectSupport( this.ifcdb.viewer.viewer.renderer ) )\r\n\r\n\r\n  loader.setWithCredentials(true);\r\n  loader.manager.file=file;\r\n  loader.setResourcePath(file);\r\n\r\n\r\n  this.name=file;\r\n  var me=this;\r\n  this.loading=true;\r\ntry\r\n{\r\n  console.log(\"loading \"+file);\r\n  loader.setCrossOrigin(\"*\");\r\n  loader.loadAsync(file).then(function(gltf)\r\n  {\r\n     console.log(\"loaded \"+file,gltf);\r\n      me.gltf=gltf;\r\n      if (!me.simpleMode)\r\n      {\r\n        if (!me.needsTranslation)\r\n        {\r\n           me.processGLTF(gltf);\r\n        }\r\n        else\r\n        {\r\n          console.log(\"glb file needs translation so not processed\");\r\n          me.processGLTF(gltf,me.getCenter());\r\n        }\r\n      }\r\n      me.loading=false;\r\n      if (rv!=null){rv.call(me);}\r\n   },function (progress){\r\n    //console.log(progress);\r\n  },function(error)\r\n    {\r\n      console.log(\"error\",error);\r\n      window.alert(\"error loading file\");\r\n      me.loading=false;\r\n      if (rv!=null){rv.call(me);}\r\n\r\n    }\r\n  \r\n   ).catch(err => {console.log(err); alert(\"could not load 3d file\")});\r\n  }\r\n  catch(e)\r\n  {\r\n    window.alert(\"error loading model \");\r\n    me.loading=false;\r\n    if (rv!=null){rv.call(me);}\r\n  }\r\n}\r\n\r\ngetCenter()\r\n{\r\n  console.log(this,this.gltf);\r\n  const aabb = new Box3().setFromObject(this.gltf.scene);\r\n  const center = aabb.getCenter( new Vector3() );\r\n  return center;\r\n}\r\n\r\nneedsTranslation()\r\n{\r\n \r\n  const center = this.getCenter();\r\n \r\n  if ((Math.abs(center.x)>1000) || (Math.abs(center.y)>1000) || (Math.abs(center.z)>1000) )\r\n  {\r\n  \r\n    return true;\r\n  }\r\n  else\r\n  {\r\n    console.log(\"no need for extra translations\");\r\n  }\r\n  return false;\r\n}\r\n\r\n\r\n\r\naddDefaultToScene()\r\n{\r\n  console.log(\"add \",this.name,\" to the scene\" );\r\n  this.ifcdb.rootGroup.add(this.gltf.scene);\r\n // console.log(this.gltf.scene);\r\n}\r\ngetDefaultScene()\r\n{\r\n  return this.gltf.scene;\r\n}\r\n\r\n\r\n\r\ngetChild(guid)\r\n {\r\n      for (var n in this.allNodes)\r\n      {\r\n          var child = this.allNodes[n];\r\n          if (child.name==guid)\r\n          return child;\r\n      }\r\n    return null;\r\n  }\r\n\r\nprocessGLTF(gltf,ncenter)\r\n{\r\n \r\n   this.allBFGs={};\r\n   this.allNodes=[];\r\n   this.allFirstChild={}\r\n   this.allFirstMaterial={};\r\n   this.loading=null;\r\n   this.defaultChilds=null;\r\n\r\n   this.resetMatrix(gltf.scene);\r\nif (ncenter!=null)\r\n{\r\n \r\n  console.log(\"translating the scene \",this.name);\r\n  this.ncenter=ncenter;\r\n \r\n\r\n}\r\n \r\n/*\r\n const aabb = new Box3().setFromObject( gltf.scene );\r\n  const center = aabb.getCenter( new Vector3() );\r\n  var size = aabb.getSize( new Vector3() );\r\n*/\r\n \r\n      for (var n in gltf.scene.children )\r\n      {\r\n                let child = gltf.scene.children[n];\r\n                this.processGLTFElement(child,ncenter);\r\n      }\r\n\r\n\r\n      console.log(\"ready processing gltf\");\r\n\r\n}\r\n\r\nresetMatrix(child)\r\n{\r\n             child.matrix=new Matrix4();\r\n             child.matrixWorld=new Matrix4();\r\n             if (child.parent!=null)\r\n             {\r\n                this.resetMatrix(child.parent);\r\n             }\r\n}\r\n\r\nprocessGLTFElement(child,ncenter)\r\n{\r\n     if ( (child.isMesh) && (child.isObject3D)  && (child.geometry!=null) && (child.children.length==0))\r\n     {\r\n         if (child.geometry.isBufferGeometry)\r\n         {\r\n          \r\n         }\r\n         else\r\n         {\r\n          console.log(\"dit heeft een andere geometry \",child.geometry);\r\n         // child.removeFromParent();\r\n          return;\r\n         }\r\n     }\r\n  \r\n\r\n      let cid=\"default\";\r\n      let color={r:1,b:1,g:1};\r\n      try\r\n      {\r\n           color=child.material.color;\r\n           cid= color.r+\"_\"+color.g+\"_\"+color.b;\r\n      }\r\n      catch(e)\r\n      {\r\n     //  console.log(e,child);\r\n\r\n\r\n      }\r\n      var ar=this.allBFGs[cid];\r\n \r\n      if (ar==null)\r\n      {\r\n        ar=[];\r\n        this.allBFGs[cid]=ar;\r\n        this.allFirstChild[cid]=color;\r\n        this.allFirstMaterial[cid]=child.material;\r\n       \r\n      }\r\n     \r\n\r\n     \r\n\r\n      child.updateMatrix(true);\r\n      child.updateMatrixWorld(true);\r\n      \r\n     \r\n        if (child.children!=null)\r\n        {\r\n        \r\n          \r\n          for (var n in child.children)\r\n          {\r\n                  var sub=child.children[n];\r\n                  this.processGLTFElement(sub,ncenter);\r\n              \r\n          }\r\n          if (child.geometry==null)\r\n          {\r\n            return;\r\n          }\r\n         // return;\r\n        }\r\n\r\n             var g = child.geometry;\r\n             g=g.clone(); // geometry can be re-used by other childs\r\n             var matrix = child.matrixWorld.clone();\r\n             child.geometry=g;\r\n         \r\n             if (ncenter!=null)\r\n             {\r\n                  var matrixT=new Matrix4();\r\n                  matrixT.makeTranslation(-ncenter.x,-ncenter.y,-ncenter.z);\r\n                  matrix=matrixT.multiply(matrix);\r\n             }\r\n             g=g.applyMatrix4(matrix);\r\n         \r\n     \r\n        ar.push(g);\r\n       g.guid=child.name;\r\n\r\n        this.allNodes.push(child); //for picking and for reference\r\n        this.aantal++;\r\n        this.subAantal++;\r\n        if (this.subAantal>1000)\r\n        {\r\n         // console.log(child);\r\n         //  console.log(this.aantal+\" objecten verwerkt. nog niet klaar\");\r\n         //   console.log(this.tobeprocessedBindings,this.aantalBindings);\r\n            this.subAantal=0;\r\n        }\r\n     \r\n\r\n    }\r\n\r\n\r\n    visualize(b)\r\n    {\r\n      this.visible=b;\r\n       if (this.defaultChilds==null)\r\n       {\r\n\r\n        let colorMat={};\r\n        for (var key in this.allBFGs)\r\n          {\r\n            let color=this.allFirstChild[key];\r\n            let mat2 =this.allFirstMaterial[key];\r\n            var mat=this.ifcdb.getDefaultColor(color,mat2);\r\n            colorMat[key]=mat;\r\n          }\r\n          this.defaultChilds=this.ifcdb.processColoring(this.allBFGs,colorMat);\r\n       }\r\n\r\n     //   console.log(this.defaultChilds);\r\n     console.log(this.name+\" visualise \"+b);\r\n      for (var n in this.defaultChilds)\r\n      {\r\n        this.ifcdb.rootGroup.add( this.defaultChilds[n]);\r\n      }\r\n    }\r\n\r\n    \r\n  }\r\n\r\n  export default IFCGLBFile\r\n","import { IFCLoader  } from \"web-ifc-three/IFCLoader\";\r\n\r\nclass IFCFile\r\n{\r\n\r\n    ifcdb=null;\r\n    name=null;\r\n    visible=true;\r\n    root=null;\r\n    allBFGs={};\r\n    allFirstChild={}\r\n    allFirstMaterial={};\r\n\r\n   \r\n\r\n\r\n\r\n\r\n    static wasmLoaded=false;\r\n\r\n\r\n  constructor(ifcdb,file,rv)\r\n{\r\n  this.ifcdb=ifcdb;\r\n  var loader = new IFCLoader();\r\n  this.name=file;\r\n  var me=this;\r\n  this.loading=true;\r\n  var me=this;\r\n   \r\n      loader.ifcManager.setWasmPath(\"../../../bb/wasm/\").then(function(){\r\n        IFCFile.wasmLoaded=true;\r\n        me.loadReallyIFC(loader,file,rv)\r\n  });\r\n\r\n}\r\n\r\n\r\n\r\nloadReallyIFC(loader,file,rv)\r\n{\r\n    loader.setWithCredentials(true);\r\n    var me=this;\r\n   \r\n    loader.load(file,function(gltf)\r\n    {\r\n       console.log(gltf);\r\n       var materials =gltf.mesh.material;\r\n       var groups=gltf.mesh.groups; //{ start: 0, count: 3450, materialIndex: 0 }\r\n\r\n\r\n       me.allBFGs[\"default\"]=gltf;\r\n       me.allFirstChild[\"default\"]=gltf.material.color;\r\n       me.allFirstMaterial[\"default\"]=gltf.material;\r\n      \r\n      me.loading=false;\r\n      if (rv!=null){rv.call(me);}\r\n    });\r\n}\r\n\r\n}\r\n\r\nexport default IFCFile","\r\nimport { ConstructionOutlined } from \"@mui/icons-material\";\r\nimport { tr } from \"date-fns/locale\";\r\nimport {Color,MeshPhysicalMaterial,Mesh,BufferGeometry,MeshToonMaterial, MeshPhongMaterial,MeshLambertMaterial } from \"three\";\r\n\r\n\r\nclass IFCDBSparql\r\n{\r\n    ifcdb=null;\r\n    guid_label={};\r\n    colorMat={};\r\n    latestData=null;\r\n    guid_color=null;\r\n\r\nconstructor(ifcdb)\r\n{\r\n  this.ifcdb=ifcdb;\r\n}\r\n\r\nuseSparqlColors()\r\n{\r\n  try\r\n  {\r\n    if (this.ifcdb.viewer.props.data!=null)\r\n    {\r\n      var results=this.ifcdb.viewer.props.data.results;\r\n      if (results.bindings.length>0) return true;\r\n      this.latestData=null;\r\n\r\n    }\r\n  }\r\n  catch(e)\r\n  {}\r\n  return false;\r\n}\r\n\r\namoutOfSparqlResults()\r\n{\r\n  try\r\n  {\r\n  if (this.ifcdb.viewer.props.data!=null)\r\n  {\r\n    var results=this.ifcdb.viewer.props.data.results;\r\n    return results.bindings.length;\r\n  }\r\n}\r\ncatch(e)\r\n{}\r\n  return 0;\r\n}\r\n\r\ngetLabel(guid)\r\n{\r\n  return this.guid_label[guid];\r\n}\r\n\r\n\r\n\r\nprocessSparqlResults()\r\n{\r\n  var guid_color = {};\r\n  this.guid_color=guid_color;\r\n  this.guid_label={};\r\n  try\r\n  {\r\n    var results=this.ifcdb.viewer.props.data.results;\r\n    for (var n in results.bindings)\r\n    {\r\n         var binding = results.bindings[n];\r\n         var guid=binding.guid.value;\r\n         var color=binding.color.value;\r\n         guid_color[guid]=color;\r\n         try{var label = binding.label.value; this.guid_label[guid]=label;}catch(e){}\r\n    }\r\n  }\r\n  catch(e)\r\n  {}\r\n  return guid_color;\r\n}\r\n\r\ngetColor(value)\r\n{\r\n  try\r\n  {\r\n      if ( (value.startsWith(\"#\")) && (value.length==7) )\r\n    {\r\n       return value;\r\n    }\r\n  }\r\n  catch(e){}\r\n   try\r\n   {\r\n    return this.stringToColour(value);\r\n   }\r\n   catch(e){}\r\n\r\n  return \"#ff0000\";\r\n}\r\n\r\nstringToColour(str) {\r\n  var hash = 0\r\n  for (let i = 0; i < str.length; i++) {\r\n    hash = str.charCodeAt(i) + ((hash << 5) - hash)\r\n  }\r\n  var colour = '#'\r\n  for (let i = 0; i < 3; i++) {\r\n    var value = (hash >> (i * 8)) & 0xff\r\n    colour += ('00' + value.toString(16)).substr(-2)\r\n  }\r\n  return colour\r\n}\r\n componentToHex(c) {\r\n  var hex = c.toString(16);\r\n  return hex.length == 1 ? \"0\" + hex : hex;\r\n}\r\n\r\n rgbToHex(r, g, b) {\r\n  return \"#\" + this.componentToHex(r) + this.componentToHex(g) + this.componentToHex(b);\r\n}\r\n\r\n\r\n\r\n\r\n\r\nneedsUpdate()\r\n{\r\n  //console.log(this.latestData,this.ifcdb.viewer.props.data);\r\n  try {if (this.latestData==this.ifcdb.viewer.props.data) return false;}\r\n  catch(e ){}\r\n  return true;\r\n}\r\n\r\nsetSparqlColors_double(guid_color)\r\n{\r\n console.log(\"double coloring strategy\");\r\n  try\r\n  {\r\n       for (var fn in this.ifcdb.ifcfiles)\r\n        {\r\n          var ifc = this.ifcdb.ifcfiles[fn];\r\n          if (!ifc.visible) continue;\r\n          ifc.visualize(true);\r\n          for (var n in ifc.allNodes)\r\n          {\r\n    \r\n                let child = ifc.allNodes[n];\r\n                if (child.geometry!=null)\r\n                {\r\n                  var ifcguid=child.name;\r\n                  var colorString=guid_color[ifcguid];\r\n                  if (colorString!=null) \r\n                  {\r\n                      let color=this.getColor(colorString);\r\n                      var mat = new  MeshPhysicalMaterial({color:color});\r\n                      mat.vertexColors=false;\r\n                      var g=child.geometry.clone();\r\n                      var cchild2=new Mesh();\r\n                      cchild2.geometry=g;\r\n                      cchild2.material=mat;\r\n                      this.ifcdb.rootGroup.add(cchild2);\r\n                   }\r\n                }\r\n        \r\n          }     \r\n        }\r\n\r\n       this.ifcdb.viewer.viewer.zoomAt(this.ifcdb.rootGroup);\r\n\r\n\r\n       \r\n\r\n\r\n  }\r\n  catch(e)\r\n  {\r\n     console.log(e);\r\n     this.ifcdb.defaultColor();\r\n  }\r\n}\r\n\r\n\r\n\r\n\r\nsetSparqlColors_ReOrganise(guid_color)\r\n{\r\n  console.log(\"reorganise coloring strategy\");\r\n  try\r\n  {\r\n  \r\n\r\n    var colorMat={};\r\n    this.colorMat=colorMat;\r\n     this.hash={};\r\n    var hash=this.hash;\r\n\r\n        hash[\"default\"]=[];\r\n        colorMat[\"default\"]=this.ifcdb.getDefaultColor(\"#aaaaaa\");\r\n   \r\n        for (var fn in this.ifcdb.ifcfiles)\r\n        {\r\n          var ifc = this.ifcdb.ifcfiles[fn];\r\n          if (!ifc.visible) continue;\r\n    \r\n          for (var n in ifc.allNodes)\r\n          {\r\n    \r\n                let child = ifc.allNodes[n];\r\n                if (child.geometry!=null)\r\n                {\r\n                  var ifcguid=child.name;\r\n                  var colorString=guid_color[ifcguid];\r\n                  if (colorString==null) colorString=\"default\";\r\n                  var ar=hash[colorString];\r\n                   if (ar==null)\r\n                   {\r\n                    ar=[];\r\n                    hash[colorString]=ar;\r\n                    let color=this.getColor(colorString);\r\n                    var mat = new  MeshPhysicalMaterial({color:color});\r\n                    mat.vertexColors=false;\r\n                    colorMat[colorString]=mat;\r\n                   }\r\n                 // ar.push(child.geometry.clone()); //not sure about this\r\n                 ar.push(child.geometry);\r\n                }\r\n        \r\n          }     \r\n        }\r\n    // console.log(hash,colorMat);\r\n        this.ifcdb.processColoring(hash,colorMat);\r\n\r\n  }\r\n  catch(e)\r\n  {\r\n     console.log(e);\r\n     this.ifcdb.defaultColor();\r\n  }\r\n}\r\n\r\n\r\n\r\nsetSparqlColors()\r\n{\r\n  if (this.ifcdb.loadingInProgress) {\r\n    //console.log(\"no sparql colors because of loading =true\");\r\n    return;\r\n  }\r\n // console.log(\"set sparql colors\");\r\n  try {this.latestData=this.ifcdb.viewer.props.data}catch(e){}\r\n  \r\n    var guid_color =this.processSparqlResults();\r\n    var amount=this.amoutOfSparqlResults();\r\n   if (amount<100)\r\n   {\r\n    \r\n        this.setSparqlColors_double(guid_color);\r\n   }\r\n   else\r\n   {\r\n        this.setSparqlColors_ReOrganise(guid_color); //good\r\n   }\r\n  \r\n}\r\n\r\n\r\n}\r\nexport default IFCDBSparql;\r\n\r\n","import _ from \"lodash\";\r\nimport {Mesh,LoadingManager,Box3,MeshDepthMaterial,DoubleSide,Group,Color,Vector3,Matrix4, BufferGeometry,MeshPhysicalMaterial,MeshStandardMaterial, MeshDistanceMaterial, MeshToonMaterial, MeshPhongMaterial,MeshLambertMaterial,AmbientLight, AxesHelper, DirectionalLight, GridHelper, PerspectiveCamera, Scene, WebGLRenderer,Object3D } from \"three\";\r\nimport { GLTFLoader } from 'three/examples/jsm/loaders/GLTFLoader'\r\nimport * as BufferGeometryUtils from \"three/examples/jsm/utils/BufferGeometryUtils.js\";\r\nimport IFCGLBFile from \"./IFCGLBFile\";\r\nimport IFCFile from \"./IFCFile\";\r\nimport IFCDBSparql from \"./IFCDBSparql\";\r\n\r\n\r\nclass IFCDB\r\n{\r\n    onlyOnce=true;\r\n    pickGroup=null;\r\n    rootGroup=null;\r\n\r\n    ifcfiles=[];\r\n\r\n    inputChanged=false;\r\n    loadingInProgress=false;\r\n    ifcdbsparql=null;\r\n  //sparql variant\r\n   latestBindings=null;\r\n   selectOnlySparqlResults=false;\r\n\r\n\r\n   tx=0;\r\n   ty=0;\r\n   tz=0;\r\n\r\n     \r\n constructor()\r\n {\r\n    //  console.log(\"creating IFCDB.....\");\r\n    this.ifcdbsparql=new IFCDBSparql(this);\r\n }\r\n\r\n\r\nprocessedAll(reusepickgroup)\r\n{\r\n var center=null;\r\n\r\n \r\n  if(this.inputChanged)\r\n  {\r\n      //console.log(\"we should update so not processing\");\r\n     // console.log(\"loading fasle\",this.loadingInProgress);\r\n      this.loadingInProgress=false;\r\n      this.inputChanged=false;\r\n      this.viewer.updateRender(true);\r\n\r\n      return;\r\n\r\n  }\r\n\r\n\r\n\r\n  this.emptyScene();\r\n \r\n\r\n      if (this.ifcdbsparql.useSparqlColors())\r\n      {\r\n       // console.log(\"setting sparql based colors\");\r\n        this.loadingInProgress=false;\r\n        this.ifcdbsparql.setSparqlColors();\r\n      }\r\n      else\r\n      {\r\n       // console.log(\"setting default colors\");\r\n        this.defaultColor();\r\n      \r\n      }\r\n      \r\n      \r\n\r\n\r\n   if ((this.pickGroup!=null) && (reusepickgroup) )\r\n   {\r\n      console.log(\"reusing pickgroup\")\r\n   }\r\n   else\r\n   {\r\n        this.pickGroup=null;\r\n        this.createNewPickGroup();\r\n   }\r\n  //console.log(\"ready inserting\");\r\n\r\n  if (this.onlyOnce)\r\n  \r\n  {\r\n    \r\n\r\n    //console.log(\"fit camera\",this.viewer.viewer.scene);\r\n    let l =this.viewer.viewer.scene.children.length;\r\n    //this.viewer.viewer.fitCameraToCenteredObject(this.viewer.viewer.scene.children[l-1]);\r\n\r\n    //this.onlyOnce=false;\r\n  }\r\n\r\n  //this.viewer.viewer.camera.near=100;\r\n  //this.viewer.viewer.camera.updateProjectionMatrix();\r\n\r\n  this.viewer.viewer.controls.update();\r\n  this.viewer.viewer.setSelectedGuid();\r\n  this.viewer.viewer.setAnimeerAantal(20);\r\n\r\n\r\n\r\nthis.viewer.props.setLoading(false);\r\n//console.log(\"loading fasle\",this.loadingInProgress);\r\nthis.loadingInProgress=false;\r\n\r\nwindow.top.scene=this.viewer.viewer.scene;// for debug\r\nif (this.needsTranslation()) \r\n{\r\n   // this.performTranslation(reusepickgroup);\r\n}\r\n;\r\nthis.translateIntoView();\r\n\r\n \r\n}\r\n\r\nperformTranslation(reusepickgroup)\r\n{\r\n  if (this.onlyOnceTranslationDebug==true) return;\r\n  this.onlyOnceTranslationDebug=true;\r\n\r\n  const aabb = new Box3().setFromObject(this.viewer.viewer.scene);\r\n  const center = aabb.getCenter( new Vector3() );\r\n    console.log(\"needs translation so we should do this \",center);\r\n    for (var fn in this.ifcfiles)\r\n    {\r\n      var ifc = this.ifcfiles[fn];\r\n      if (!ifc.visible) continue;\r\n      ifc.processGLTF(ifc.gltf,center);\r\n    }\r\n\r\n\r\n    this.processedAll(reusepickgroup);\r\n\r\n\r\n}\r\n\r\nneedsTranslation()\r\n{\r\n // const aabb = new Box3().setFromObject(this.viewer.viewer.scene);\r\n  const aabb = new Box3().setFromObject(this.rootGroup);\r\n  const center = aabb.getCenter( new Vector3() );\r\n  var size = aabb.getSize( new Vector3() );\r\n \r\n  if ((Math.abs(center.x)>1000) || (Math.abs(center.y)>1000) || (Math.abs(center.z)>1000) )\r\n  {\r\n  \r\n    return true;\r\n  }\r\n  else\r\n  {\r\n    console.log(\"no need for extra translations\");\r\n  }\r\n  return false;\r\n}\r\n\r\n\r\ntranslateIntoView()\r\n{\r\n  this.viewer.viewer.zoomAt(this.rootGroup);\r\n  console.log(\"translate into view\");\r\n \r\n   \r\n  \r\n}\r\n\r\n\r\n\r\ngetDefaultColor(color,defaultMat)\r\n{\r\n\r\n  var hint=this.viewer.props[\"visualisation hint\"];\r\n  if (hint==null)hint=\"normal\";\r\n\r\n  //var mat= new MeshStandardMaterial({color:color}); //good!\r\n\r\n  var mat = new MeshPhysicalMaterial({color:color});\r\n  \r\n\r\n  if (hint==\"grey\")\r\n  {\r\n    mat = new MeshPhysicalMaterial({color:\"#c0c0c0\"});\r\n    mat.vertexColors=false;//bijna zeker\r\n    mat.fog=true;\r\n   \r\n  }\r\n  if (hint==\"greytransparent\")\r\n  {\r\n    mat = new MeshPhysicalMaterial({color:\"#c0c0c0\"});\r\n    mat.vertexColors=false;//bijna zeker\r\n    mat.fog=true;\r\n    mat.transparent=true;\r\n    mat.opacity=0.4;\r\n   \r\n  }\r\n  if (hint==\"greyverytransparent\")\r\n  {\r\n    mat = new MeshPhysicalMaterial({color:\"#c0c0c0\"});\r\n    mat.vertexColors=false;//bijna zeker\r\n    mat.fog=true;\r\n    mat.transparent=true;\r\n    mat.opacity=0.1;\r\n   \r\n  }\r\n\r\n  if (hint==\"nice\")\r\n  {\r\n    mat= new MeshPhongMaterial({shininess: 50,emissiveIntensity:0.2,lightMapIntensity:0.4,emissive:color});\r\n    mat.vertexColors=false;//bijna zeker\r\n    mat.fog=true;\r\n   \r\n  }\r\n\r\n  if (hint==\"normal\")\r\n  {\r\n   // mat.vertexColors=false;//bijna zeker\r\n    //mat.fog=true;\r\n    if (defaultMat!=null)\r\n    {\r\n      //mat=defaultMat;\r\n    }\r\n    mat.transparent=true;\r\n    mat.opacity=0.99;\r\n   \r\n \r\n  }\r\n  if (hint==\"transparent\")\r\n  {\r\n    mat.transparent=true;\r\n    mat.opacity=0.4;\r\n  }\r\n  if (hint==\"vtransparent\")\r\n  {\r\n    mat.transparent=true;\r\n    mat.opacity=0.1;\r\n  }\r\n\r\n  if (hint==\"toon\")\r\n  {\r\n    mat=new MeshToonMaterial({shininess: 50,emissiveIntensity:0.2,lightMapIntensity:0.4,emissive:color,color:color})\r\n  \r\n  }\r\n  if (hint==\"toontransparent\")\r\n  {\r\n    mat=new MeshToonMaterial({shininess: 50,emissiveIntensity:0.2,lightMapIntensity:0.4,emissive:color,color:color})\r\n    mat.transparent=true;\r\n    mat.opacity=0.4;\r\n  \r\n  }\r\n\r\n  mat.depthWrite =true;\r\nreturn mat;\r\n}\r\n\r\ndefaultColor()\r\n{\r\n \r\n  for (var fn in this.ifcfiles)\r\n  {\r\n    var ifc = this.ifcfiles[fn];\r\n    if (!ifc.visible) continue;\r\n\r\n    let colorMat={};\r\n    \r\n    \r\n\r\n   if (!ifc.simpleMode)\r\n   {\r\n\r\n      for (var key in ifc.allBFGs)\r\n        {\r\n          let color=ifc.allFirstChild[key];\r\n          let mat2 =ifc.allFirstMaterial[key];\r\n          var mat=this.getDefaultColor(color,mat2);\r\n          colorMat[key]=mat;\r\n        }\r\n        this.processColoring(ifc.allBFGs,colorMat);\r\n    }\r\n    else\r\n    {\r\n      ifc.addDefaultToScene();\r\n    //  console.log(ifc.gltf);\r\n    }\r\n  }\r\n\r\n}\r\n\r\nprocessColoring(colorHash,colorMat)\r\n{\r\n  // console.log(\"inserting array objects into scene \",colorHash,colorMat);\r\n   this.colorMat=colorMat;\r\n  var rar=[];\r\n   \r\n    var latestChild=null;\r\n    for (var key in colorHash)\r\n    {\r\n      var ar = colorHash[key];\r\n      var cchild2=new Mesh();\r\n      latestChild=cchild2;\r\n     \r\n      if ((ar==null) || (ar.length==0) ) continue;\r\n\r\n      cchild2.geometry=BufferGeometryUtils.mergeBufferGeometries(ar);\r\n       var mat  = colorMat[key];\r\n       cchild2.material=mat;\r\n       cchild2.matrixAutoUpdate=false;\r\n       cchild2.castShadow=false;\r\n       cchild2.receiveShadow=false;\r\n       this.rootGroup.add(cchild2);\r\n       rar.push(cchild2);\r\n    }\r\n    \r\n\r\n  return rar;\r\n}\r\n\r\n\r\ngetNewRootGroup(b)\r\n{\r\n    var g =new Group();\r\n    g.matrixAutoUpdate=true;\r\n    g.castShadow=true;\r\n    g.receiveShadow=true;\r\n    return g;\r\n}\r\n\r\n\r\n\r\ngetPickGroup()\r\n{\r\n   if (this.pickGroup!=null) return this.pickGroup.children;\r\n   return [];\r\n}\r\n\r\n\r\ncreateNewPickGroup()\r\n{\r\n \r\n   this.pickGroup=this.getNewRootGroup();\r\n \r\n   for (var fn in this.ifcfiles)\r\n   {\r\n        var ifc = this.ifcfiles[fn];\r\n        if (!ifc.visible) continue;\r\n\r\n        if (ifc.simpleMode)\r\n        {\r\n          \r\n          this.pickGroup.add(ifc.getDefaultScene().clone(true));\r\n        }\r\n        else\r\n        {\r\n     \r\n              for (var n in ifc.allNodes)\r\n              {\r\n                try\r\n                {\r\n                  \r\n                var mesh=new Mesh();\r\n                var child =ifc.allNodes[n];\r\n\r\n                mesh.geometry=child.geometry;\r\n                if (mesh.geometry==null) continue;\r\n                mesh.ifcguid=child.name;\r\n\r\n                var c=null;\r\n                if (this.selectOnlySparqlResults)\r\n                {\r\n                  try {c=this.ifcdbsparql.guid_color[mesh.ifcguid];} catch(e){}\r\n                  if (c!=null)\r\n                  {\r\n                      this.pickGroup.add(mesh);\r\n                      mesh.updateMatrix();\r\n                      mesh.updateWorldMatrix(true,true);\r\n                  }\r\n\r\n                }\r\n                else\r\n                {\r\n                  this.pickGroup.add(mesh);\r\n                  mesh.updateMatrix();\r\n                  mesh.updateWorldMatrix(true,true);\r\n                }\r\n            \r\n                }\r\n                catch(e){}\r\n                \r\n\r\n              }\r\n    }\r\n  }\r\n\r\n  //console.log(\"created pickgroup children \",this.pickGroup.children.length);\r\n   return  this.pickGroup.children;\r\n\r\n}\r\n\r\n\r\n\r\n  shouldLoadNewFiles(files)\r\n  {\r\n  \r\n    for (var n in files)\r\n    {\r\n      var nfile =files[n];\r\n      var f =this.getIFCFile(nfile);\r\n      if (f==null) return true;\r\n      if (f.visible==false) return true;\r\n    }\r\n    // zijn er ook ifc files visible die niet visible moeten zijn?\r\n     for (var n in this.ifcfiles)\r\n     {\r\n        var ifc =this.ifcfiles[n];\r\n        if (ifc.visible)\r\n        {\r\n          if (files.includes(ifc.name)==false) return true;\r\n        }\r\n     }\r\n\r\n   \r\n\r\nreturn false;\r\n    \r\n\r\n  }\r\n\r\n  getChild(guid)\r\n  {\r\n    for (var n in this.ifcfiles)\r\n    {\r\n      var ifcFile=this.ifcfiles[n];\r\n      if (ifcFile.visible)\r\n      {\r\n           var child = ifcFile.getChild(guid);\r\n           if (child!=null) return child;\r\n\r\n      }\r\n    }\r\n  }\r\n\r\n  setVisible(b)\r\n  { \r\n    for (var n in this.ifcfiles)\r\n    {\r\n      var ifcFile=this.ifcfiles[n];\r\n      ifcFile.visible=b;\r\n    }\r\n  }\r\n  isEmpty()\r\n  {\r\n    \r\n    for (var n in this.ifcfiles)\r\n    {\r\n      var ifcFile=this.ifcfiles[n];\r\n      if (ifcFile.visible) return false;\r\n    }\r\n    return true;\r\n  }\r\n\r\nemptyScene()\r\n{\r\n\r\n  if (this.viewer.viewer.scene!=null)  \r\n    {\r\n\r\n      this.viewer.viewer.createNewScene(this.viewer.viewer.scene);\r\n      this.viewer.viewer.controls.enabled=true;\r\n      this.viewer.viewer.orbiting=true;\r\n      this.rootGroup=this.getNewRootGroup(false);\r\n      this.viewer.viewer.scene.add(this.rootGroup);\r\n     \r\n    }\r\n}\r\n\r\nloadGLBFiles(viewer,files)\r\n  {\r\n    this.viewer=viewer;\r\n    \r\n    //console.log(\"loadGLBFiles called \",this.loadingInProgress,files);\r\n     if (this.loadingInProgress)\r\n     { \r\n            console.log(\"not loading glb files because already loading \");\r\n       return     false;\r\n     }\r\n \r\n     this.loadingInProgress=true;\r\n\r\n     this.asyncLoadGLBFiles(viewer,files.slice());\r\n\r\n  }\r\n\r\n  getIFCFile(file)\r\n  {\r\n     for (var n in this.ifcfiles)\r\n     {\r\n\r\n        if (this.ifcfiles[n].name==file) return this.ifcfiles[n];\r\n     }\r\n     return null;\r\n  }\r\n\r\n // async asyncLoadGLBFiles(viewer,files)\r\n  asyncLoadGLBFiles(viewer,files)\r\n  {\r\n   \r\n   var me=this;\r\n \r\n    this.loadedfiles=files;\r\n  \r\n    var me = this;\r\n   \r\n      this.reset();\r\n    this.setVisible(false);\r\n\r\n       \r\n   // console.log(\"setting amount of files to be loaded \",this.tobeprocessedFiles);\r\n   var loadingNewFiles = false;\r\n    for (var n in files)\r\n    {\r\n                var file = files[n];\r\n              \r\n                var ifcFile=this.getIFCFile(file);\r\n                if (ifcFile!=null)\r\n                {\r\n                  ifcFile.visible=true;\r\n                \r\n                   continue;\r\n                }\r\n               \r\n                loadingNewFiles=true;\r\n              \r\n                if (file.toLowerCase().endsWith(\".glb\"))\r\n                {\r\n                   var simpleMode=this.viewer.props.simpleMode;\r\n                  // console.log(\"simple mode \",simpleMode);\r\n                   \r\n                  var ifcFile = new IFCGLBFile(this,file,function(){me.readyLoading()},simpleMode);\r\n                  this.ifcfiles.push(ifcFile);\r\n                }\r\n                else\r\n                {\r\n                  if (file.toLowerCase().endsWith(\".ifc\"))\r\n                  {\r\n                \r\n                    var ifcFile = new IFCFile(this,file,function(){me.readyLoading()});\r\n                    this.ifcfiles.push(ifcFile);\r\n                  }\r\n                  else\r\n                  {\r\n                    console.log(\"cannot load file \");\r\n                  // window.alert(\"cannot load file \"+file);\r\n                    me.readyLoading();\r\n                  }\r\n                }\r\n\r\n\r\n               \r\n           \r\n                //)\r\n      }\r\n\r\n      if (loadingNewFiles==false)\r\n      {\r\n         this.processedAll();\r\n      }\r\n\r\n   \r\n  }\r\nreadyLoading()\r\n{\r\n  //console.log(\"ready loading called\");\r\n  for (var n in this.ifcfiles)\r\n  {\r\n    if (this.ifcfiles[n].loading) return;\r\n  }\r\n // console.log(\"all are loading to processing them all\");\r\n  this.processedAll();\r\n}\r\n \r\n\r\n reset()\r\n {\r\n  \r\n  \r\n  //console.log(\"RESET empy\");\r\n  \r\n\r\n }\r\n\r\n\r\n\r\n\r\n\r\n\r\n  processSparqlResults(viewer)\r\n {\r\n    if (viewer.props.data==null) return;\r\n        this.viewer=viewer;\r\n        var bindings = viewer.props.data.results.bindings;\r\n        \r\n       this.processBindings(bindings);\r\n\r\n }\r\n\r\n \r\n processBindings(bindings)\r\n {\r\n  if (bindings==this.latestBindings) return;\r\n      var viewer= this.viewer;\r\n\r\n        var lm =new LoadingManager();\r\n         var loader = new GLTFLoader(lm);\r\n    \r\n        var me =this;\r\n       \r\n        \r\n          \r\n          // console.log(\"really processing sparql results geometry\");\r\n           if (viewer.scene!=null)  \r\n           {\r\n             viewer.createNewScene(viewer.scene);\r\n           }\r\n\r\n\r\n           this.latestBindings=bindings;\r\n           this.reset();\r\n\r\n           this.tobeprocessedBindings=bindings.length;\r\n           this.aantalBindings=0;\r\n          // console.log(\"aantal bindingen:\"+  this.tobeprocessedBindings);\r\n           loader = new GLTFLoader();\r\n           var aantal=0;\r\n      \r\n        for (var n in bindings)\r\n        {\r\n          aantal++;\r\n        \r\n         \r\n          try{\r\n                    var binding = bindings[n];\r\n                    var gltfB= binding.gltf.value;\r\n                    gltfB =JSON.parse(gltfB);\r\n                   \r\n\r\n                    var uri= binding.uri.value;\r\n                    gltfB.userData={uri:uri};\r\n                    gltfB.name=uri;\r\n\r\n                 \r\n                    loader.parse(gltfB,\"\",function(gltf){\r\n                     \r\n                      //  let child = gltf.scene.children[0];\r\n                         if  ((gltf.scene!=null) && (gltf.scene.children!=null))\r\n                         {\r\n                            me.aantalBindings++;\r\n                            me.processGLTFElement(gltf.scene.children[0],true);\r\n                         }\r\n                         else\r\n                         {\r\n\r\n                          this.aantalBindings++;\r\n                         }\r\n                    },function(err){console.log(err);})\r\n                 \r\n          }\r\n          catch(e)\r\n          {\r\n            console.log(e);\r\n            this.aantalBindings++;\r\n          }\r\n        \r\n          \r\n        }\r\n        console.log(\"klaar met bindingen\");\r\n   }\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n \r\n\r\n}\r\n\r\nexport default IFCDB;\r\n","import {Color,Box3,OrthographicCamera,Vector3,HemisphereLight,HemisphereLightHelper,Mesh,BufferGeometry,PointLight, Vector2,Raycaster,MeshToonMaterial, MeshPhongMaterial,MeshLambertMaterial,SpotLight,AmbientLight, AxesHelper, DirectionalLight, GridHelper, PerspectiveCamera, Scene, WebGLRenderer,Object3D } from \"three\";\r\nimport { GLTFLoader } from 'three/examples/jsm/loaders/GLTFLoader'\r\nimport { OrbitControls } from \"three/examples/jsm/controls/OrbitControls\";\r\nimport { MeshoptDecoder } from 'three/examples/jsm/libs/meshopt_decoder.module.js';\r\n//import { KTX2Loader } from 'three/examples/jsm/loaders/KTX2Loader.js';\r\n//import { DRACOLoader } from 'three/examples/jsm/loaders/DRACOLoader.js';\r\n\r\n\r\nimport  \"popper.js\"\r\nimport tippy,{followCursor} from \"tippy.js\"\r\n\r\nimport 'tippy.js/dist/tippy.css'; \r\nimport 'tippy.js/dist/backdrop.css';\r\nimport 'tippy.js/animations/shift-away.css';\r\n\r\nimport * as OBC from \"openbim-components\";\r\nimport gsap from \"gsap\";\r\n//import \"./tippy.js/dist/tippy-bundle.cjs.js\"\r\n\r\n\r\n\r\nclass ThreeJSViewer\r\n\r\n{\r\n  viewer=null;\r\n  scene=null;\r\n   // ifcLoader=null;\r\n    renderer=null;\r\n    raycaster=null;\r\n    //acceleratedRaycast=null;\r\n    camera=null;\r\n    pointer=new Vector2();\r\n    selectedChild=null;\r\n    hooverChild=null;\r\n    orbiting=false;\r\n    threeCanvas=null;\r\n    animeerAantal=10;\r\n\r\n\r\n\r\n    initViewerNT(viewer)\r\n    {\r\n       this.viewer=viewer;\r\n\r\n       const tcid=\"three-canvas\"+this.viewer.id;\r\n       const threeCanvas = document.getElementById(tcid);\r\n      \r\n       this.threeCanvas=threeCanvas;\r\n\r\n       const components = new OBC.Components();\r\n       components.scene = new OBC.SimpleScene(components);\r\n       components.renderer = new OBC.SimpleRenderer(components, threeCanvas);\r\n       \r\n        this.renderer = components.renderer;\r\n       // renderer.postproduction.outlineColor = 0x999999;\r\n\r\n        const camera =  new OBC.SimpleCamera(components);\r\n        components.camera = camera;\r\n        \r\n        this.camera=camera;\r\n       components.raycaster = new OBC.SimpleRaycaster(components);\r\n       \r\n       components.init();\r\n\r\n\r\n\r\n       \r\n       // Add some elements to the scene\r\n       \r\n       const scene = components.scene.get();\r\n     this.scene=scene;\r\n\r\n\r\n     const shadows = new OBC.ShadowDropper(components);\r\n\r\n\r\n\r\n     const directionalLight = new DirectionalLight();\r\ndirectionalLight.position.set(5, 10, 3);\r\ndirectionalLight.intensity = 0.5;\r\nscene.add(directionalLight);\r\n\r\nconst ambientLight = new AmbientLight();\r\nambientLight.intensity = 0.5;\r\nscene.add(ambientLight);\r\n\r\n\r\n\r\nconst grid = new OBC.SimpleGrid(components);\r\n    components.tools.add(grid);\r\n    this.grid=grid.get();\r\n  //  renderer.postproduction.excludedItems.add(grid.get());\r\n    this.raycaster = new Raycaster();\r\n\r\n\r\n\r\n    }\r\n\r\n\r\n\r\n     initViewer(viewer)\r\n    {\r\n          this.viewer=viewer;\r\n    /*      if (false)\r\n          {\r\n          BufferGeometry.prototype.computeBoundsTree = computeBoundsTree;\r\n          BufferGeometry.prototype.disposeBoundsTree = disposeBoundsTree;\r\n          Mesh.prototype.raycast = acceleratedRaycast;\r\n          }\r\n          */\r\n          //this.setState({loading:false});\r\n\r\n            \r\n            const tcid=\"three-canvas\"+this.viewer.id;\r\n          const threeCanvas = document.getElementById(tcid);\r\n         \r\n          this.threeCanvas=threeCanvas;\r\n                    \r\n          // Object3D.DefaultUp.set(0, 1, 0);\r\n          let canvasBounds = threeCanvas.getBoundingClientRect();\r\n          \r\n          var width = canvasBounds.right - canvasBounds.left;\r\n          var height=canvasBounds.bottom - canvasBounds.top;\r\n      \r\n       \r\n   \r\n                       \r\n                           const size = {\r\n                               width: width,\r\n                               height: height,\r\n                             };\r\n                         \r\n                             const scene = new Scene();\r\n                   const aspect = size.width / size.height;\r\n                 \r\n                   const camera = new PerspectiveCamera(75, aspect);\r\n                   camera.position.z = 15;\r\n                   camera.position.y = 13;\r\n                   camera.position.x = 8;\r\n                   camera.near=1;\r\n                   camera.far=1000;\r\n                  \r\n                    this.camera=camera;\r\n   \r\n                   var pointLight = new PointLight( 0xffffff,1250 );\r\n                   pointLight.position.set(0,-10,0);\r\n                   camera.add(pointLight);\r\n   \r\n   \r\n   \r\n                   //Creates the lights of the scene\r\n                  \r\n                   scene.background = new Color( 0xeeeeee );\r\n                 \r\n   \r\n                   //Sets up the renderer, fetching the canvas of the HTML\r\n                   \r\n                   const renderer = new WebGLRenderer({\r\n                     canvas: threeCanvas,\r\n                     alpha: true,\r\n                     powerPreference:\"high-performance\",\r\n                     antialias:true,\r\n                     logarithmicDepthBuffer: true,\r\n                     sortObjects: true,\r\n                     colorManagement: true\r\n                   });\r\n\r\n\r\n                   \r\n                 \r\n\r\n                  // renderer.physicallyCorrectLights = true;\r\n                   renderer.setPixelRatio( window.devicePixelRatio );\r\n\r\n                 \r\n                   this.renderer=renderer;\r\n                   this.raycaster = new Raycaster();\r\n   \r\n                   renderer.setSize(size.width, size.height);\r\n                  // renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));\r\n                   this.renderer=renderer;\r\n                   //Creates grids and axes in the scene\r\n                   const grid = new GridHelper(50, 30);\r\n                 \r\n                   this.grid=grid;\r\n   \r\n                   const axes = new AxesHelper();\r\n                   axes.material.depthTest = false;\r\n                   axes.renderOrder = 1;\r\n\r\n                   if (true)\r\n                   {\r\n                      scene.add(axes);\r\n                       scene.add(grid);\r\n                   }\r\n   \r\n                   //Creates the orbit controls (to navigate the scene)\r\n                   const controls = new OrbitControls(camera, threeCanvas);\r\n                   controls.enableDamping = true;\r\n                   controls.target.set(-2, 0, 0);\r\n                   this.controls=controls;\r\n   \r\n                   //Animation loop\r\n                   this.animeerAantal=50;\r\n                   var me = this;\r\n   \r\n                   const animate = () => {\r\n                     if (me.animeerAantal>0)\r\n                     {\r\n                       controls.update();\r\n                       renderer.render(scene, camera);\r\n                       me.animeerAantal--;\r\n                     }\r\n                     if (me.animeerAantal>100)\r\n                     {\r\n                      me.animeerAantal=100;\r\n                     }\r\n                     requestAnimationFrame(animate);\r\n                     \r\n                   };\r\n   \r\n                   animate();\r\n                   \r\n                  \r\n                  \r\n                     renderer.render(scene, camera);\r\n                     controls.addEventListener(\"change\", () => \r\n                     {\r\n                       this.animeerAantal=50;\r\n                       });\r\n                       controls.addEventListener(\"start\", () => \r\n                       {\r\n                         this.orbiting=true;\r\n                       });\r\n                       controls.addEventListener(\"end\", () => \r\n                       {\r\n                         this.orbiting=false;\r\n                       });\r\n                  \r\n   \r\n                   //Adjust the viewport to the size of the browser\r\n                 \r\n   \r\n                   threeCanvas.addEventListener(\"hide\",(event)=>{\r\n                    console.log(event);\r\n                   });\r\n\r\n                   threeCanvas.addEventListener(\"mousemove\",(event)=>{\r\n                   \r\n                     if (this.orbiting) return;\r\n                     this.mousemove(event);\r\n                   },false)\r\n\r\n\r\n                   threeCanvas.addEventListener(\"click\",(event)=>{\r\n                  \r\n                    this.mouseclick(event);\r\n                  },false)\r\n\r\n                  threeCanvas.addEventListener(\"dblclick\",(event)=>{\r\n                  \r\n                    this.mouseDoubleClick(event);\r\n                  },false)\r\n                \r\n                   this.scene=scene;\r\n                   this.camera=camera;\r\n                   camera.updateProjectionMatrix();\r\n                 \r\n    }\r\n    resize()\r\n    {\r\n       try\r\n       {\r\n        const tcid=\"three-canvas\"+this.viewer.id;\r\n      const threeCanvas = document.getElementById(tcid);\r\n             let canvasBounds = threeCanvas.getBoundingClientRect();\r\n\r\n               var width = canvasBounds.right - canvasBounds.left+200;\r\n               var height=canvasBounds.bottom - canvasBounds.top+200;\r\n\r\n                         \r\n                           \r\n                               const size = {\r\n                                   width: width,\r\n                                   height: height,\r\n                                 };\r\n           var camera=this.camera;\r\n           camera.aspect = size.width / size.height;\r\n           camera.updateProjectionMatrix();\r\n           this.renderer.setSize(size.width, size.height);\r\n           this.animeerAantal=50;\r\n                                }\r\n                                catch(e)\r\n                                {}\r\n\r\n    }\r\n\r\n    \r\n     createNewScene(scene)\r\n    {\r\n      if (scene==null) scene=this.scene;\r\n\r\n    //  console.log(\"new scene\");\r\n       scene.clear();\r\n       const lightColor = 0x888888;\r\n       const lightColor2 = 0x445544;\r\n\r\n\r\n       const light = new HemisphereLight( 0xffffbb, 0x080820, 1 );\r\n   // const helper = new HemisphereLightHelper( light, 5 );\r\n       scene.add( light );\r\n\r\n     \r\n    \r\n       const ambientLight = new AmbientLight(lightColor, 0.01);\r\n       //scene.add(ambientLight);\r\n    \r\n       var directionalLight = new SpotLight(lightColor2, 0.7);\r\n       directionalLight.castShadow = true;\r\n       directionalLight.position.set(250, 250, 250);\r\n       directionalLight.target.position.set(0, 0, 0);\r\n     //  directionalLight.target.position.set(0, 1000, 0);\r\n       scene.add(directionalLight);\r\n       //scene.add(directionalLight.target);\r\n    \r\n    \r\n       var directionalLight = new SpotLight(lightColor, .5);\r\n       directionalLight.castShadow = true;\r\n       directionalLight.position.set(0, -250, -250);\r\n       directionalLight.target.position.set(0, 0, 0);\r\n     //  directionalLight.target.position.set(0, 1000, 0);\r\n       scene.add(directionalLight);\r\n       scene.add(directionalLight.target);\r\n       \r\n    \r\n    \r\n         //Creates grids and axes in the scene\r\n         const grid = new GridHelper(80, 80);\r\n       \r\n        \r\n       const axes = new AxesHelper();\r\n       axes.material.depthTest = false;\r\n       axes.renderOrder = 1;\r\n       if (false)\r\n       {\r\n        scene.add(axes);\r\n        scene.add(grid);\r\n       }\r\n       this.setAnimeerAantal(1);\r\n       this.resize();\r\n    \r\n    }\r\n\r\n\r\n    \r\ngetIntersection(event)\r\n{\r\n\r\n //if(true) return;\r\n if (this.orbiting)return null;\r\n if (this.raycaster==null)return null;\r\n\r\n  event.preventDefault();\r\n  \r\n  let canvasBounds = this.renderer.getContext().canvas.getBoundingClientRect();\r\n  this.pointer.x = ( ( event.clientX - canvasBounds.left ) / ( canvasBounds.right - canvasBounds.left ) ) * 2 - 1;\r\n  this.pointer.y = - ( ( event.clientY - canvasBounds.top ) / ( canvasBounds.bottom - canvasBounds.top) ) * 2 + 1;\r\n  var pg = this.viewer.ifcdb.getPickGroup();\r\n  this.raycaster.setFromCamera(this.pointer,this.camera);\r\n\r\n  if (pg==null) return;\r\n  try\r\n  {\r\n  var intersects = this.raycaster.intersectObjects(pg, true);\r\n  return intersects;\r\n  }\r\n  catch(e)\r\n  {console.log(e);}\r\n  return null;\r\n\r\n}\r\n\r\nmousemove(event)\r\n{\r\n try\r\n {\r\n     var intersects = this.getIntersection(event);\r\n     if (intersects==null) return ;\r\n  if (intersects.length>0)\r\n  {\r\n   \r\n    var child = intersects[0].object;\r\n\r\n    child=child.clone();\r\n\r\n    //console.log(child,this.selectedChild);\r\n\r\n      if ((this.hooverChild!=null) && (child==this.hooverChild.children[0])) { return;}\r\n      if ((this.selectedChild!=null) && (child==this.selectedChild.children[0])) { return;}// no hoovering on selected objects\r\n      \r\n    if (child.orgMatrix==null)\r\n    { child.orgMatrix=child.matrix;\r\n\r\n      //child.matrix.multiply(root.matrix );\r\n    }\r\n     // console.log(\"Found a child\",child,intersects);\r\n    if (child.orgMaterial==null) child.orgMaterial=child.material;\r\n    child.material=new MeshPhongMaterial({color:0x0000ff,specular: 0xaaaaaa,shininess: 1000,emissive:0x0000ff});\r\n    child.material.opacity=0.5;\r\n    child.renderOrder=10;\r\n    if (this.hooverChild!=null)\r\n    {\r\n      this.scene.remove(this.hooverChild);\r\n    }\r\n    var root =this.viewer.ifcdb.getNewRootGroup();\r\n    this.hooverChild=root;\r\n    root.add(child)\r\n    this.scene.add(root);\r\n     // console.log(child);\r\n      var msg=null;\r\n      try {\r\n        msg=this.viewer.ifcdb.ifcdbsparql.getLabel(child.geometry.guid);\r\n      } catch(e){}\r\n      if (msg!=null)\r\n      {\r\n      //\r\n        this.showTippy(msg);\r\n      }\r\n      else{\r\n        this.showTippy(\"IFC GUID:\"+child.geometry.guid);\r\n      }\r\n  }\r\n  else\r\n  {\r\n    if (this.hooverChild!=null)\r\n    {\r\n      this.scene.remove(this.hooverChild);\r\n      this.destroyTippy();\r\n    }\r\n  \r\n  }\r\n\r\n  this.setAnimeerAantal(1);\r\n  \r\n\r\n\r\n\r\n }\r\n catch(e)\r\n {\r\n    console.log(e);\r\n }\r\n\r\n}\r\nsetAnimeerAantal(aantal)\r\n{\r\n  this.animeerAantal+=aantal;\r\n}\r\n\r\nsetSelectedGuid()\r\n{\r\n\r\n\r\nvar newGuid = this.viewer.props.pubsub[this.viewer.props.guidselector];\r\n            if ((newGuid!=null) && (newGuid!=this.selectedGuid) )\r\n            {\r\n              var child=this.viewer.ifcdb.getChild(newGuid);\r\n              if (child!=null)\r\n              {\r\n              \r\n                var mesh =new Mesh();\r\n                mesh.geometry=child.geometry;\r\n                mesh.name=child.name;\r\n                var par=this.viewer.props[\"guidpublishparameter\"];\r\n                if (par!=null)\r\n              {\r\n                this.viewer.props.publish(par,child.name);\r\n                this.showSelectChild(mesh);\r\n              }\r\n              else\r\n              {\r\n                   console.log(\"could not find child\");\r\n              }\r\n\r\n\r\n            }\r\n          }\r\n\r\n\r\n\r\n}\r\nmouseDoubleClick(event)\r\n{\r\n  if (this.selectedChild!=null)\r\n  {\r\n    this.zoomAt(this.selectedChild,4);\r\n  }\r\n  \r\n}\r\n\r\nmouseclick(event)\r\n{\r\n\r\n if (this.orbiting)return;\r\n event.preventDefault();\r\nvar intersects = this.getIntersection(event);\r\nif (intersects==null) \r\n{\r\n  if (this.selectedChild!=null)\r\n  {\r\n    this.scene.remove(this.selectedChild);\r\n    this.selectedGuid=null;\r\n  }\r\nreturn ;\r\n}\r\n\r\n\r\nif (intersects.length>0)\r\n{\r\n \r\n  var child = intersects[0].object;\r\n\r\n  this.showSelectChild(child);\r\n\r\n  var par=this.viewer.props[\"guidpublishparameter\"];\r\n  if (par!=null)\r\n  {\r\n      this.viewer.props.publish(par,intersects[0].object.ifcguid);\r\n  }\r\n//guidpublishparameter\r\n\r\n\r\n\r\n\r\n}\r\nelse\r\n{\r\n  if (this.selectedChild!=null)\r\n  {\r\n   // this.scene.remove(this.selectedChild);\r\n  }\r\n}\r\n\r\n\r\n\r\n}\r\n\r\n\r\nshowSelectChild(child)\r\n{\r\n\r\n// console.log(\"geen par gevonden \",intersects[0].object)\r\nchild=child.clone();\r\n\r\n//console.log(child,this.selectedChild);\r\n\r\n  if ((this.selectedChild!=null) && (child==this.selectedChild.children[0])) { \r\n  //  console.log(\"show selected child is already selected\")\r\n    return;\r\n  }\r\n  \r\n      if (child.orgMatrix==null)\r\n      { child.orgMatrix=child.matrix;\r\n\r\n        //child.matrix.multiply(root.matrix );\r\n      }\r\n  \r\n // console.log(\"Found a child\",child,intersects);\r\nif (child.orgMaterial==null) child.orgMaterial=child.material;\r\nchild.material=new MeshPhongMaterial({color:0xff0000,specular: 0xaaaaaa,shininess: 1000,emissive:0xff0000});\r\nchild.material.opacity=0;\r\nchild.renderOrder=11;\r\nif (this.selectedChild!=null)\r\n{\r\n  this.scene.remove(this.selectedChild);\r\n  this.selectedGuid=null;\r\n}\r\nvar root =this.viewer.ifcdb.getNewRootGroup();\r\nthis.selectedChild=root;\r\nroot.add(child)\r\nthis.selectedGuid=child.name;\r\nthis.scene.add(root);\r\n\r\nthis.setAnimeerAantal(1);\r\n\r\n\r\n}\r\n\r\n\r\n\r\nzoomAt = (target,distance)=>{\r\n  console.log(\"zoom at\");\r\n  if (distance==null) distance=1;\r\n\tvar camera=this.camera;\r\n  //use this code for a object size agnostic solution; build a bounding box around your object you want to zoom and  get its size: \r\nconst aabb = new Box3().setFromObject( target );\r\nconst center = aabb.getCenter( new Vector3() );\r\nvar size = aabb.getSize( new Vector3() );\r\n\r\n\r\n  //now use gsap and not tweenjs.. never use tweenjs again. never. \r\ngsap.to( camera.position, {\r\nduration: 1,\r\nx: center.x,\r\ny: center.y+3, // place camera a bit higher than the object\r\nz: center.z + size.z+distance, // maybe adding even more offset depending on your model\r\nonUpdate: function() {\r\ncamera.lookAt( target.position ); //important \r\n}\r\n} );\r\nvar orbitControls= this.controls;\r\nthis.setAnimeerAantal(1000);\r\ngsap.to(  this.controls.target, {\r\nduration: 1,\r\nx: center.x,\r\ny: center.y, //set the center of the controler to the zoomed object \r\nz: center.z , // no distance needed\r\nonComplete: ()=>{\r\norbitControls.enabled = true; // activate the controler again after animation\r\nthis.setAnimeerAantal(10);\r\n}\r\n} );\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n showTippy(msg)\r\n{\r\n   try\r\n   {\r\n    if (msg==null)\r\n    {\r\n        msg=\"no info\";\r\n    }\r\n    if (document.tippy==null)\r\n    {\r\n    //  document.tippy=tippy( document.body, {placement:\"followCursor\", plugins: [followCursor],content: msg,followCursor: true  });\r\n    var div=document.getElementById(\"tippydiv\"+this.viewer.id);\r\n    if (div!=null)\r\n    {\r\n      document.tippy=tippy( div, {trigger: 'manual',placement:\"followCursor\", plugins: [followCursor],content: msg,followCursor: true  });\r\n    }\r\n      //document.tippy=tippy( this.threeCanvas, {placement:\"followCursor\", plugins: [followCursor],content: msg,followCursor: true  });\r\n    }\r\n    document.tippy.setContent(msg);\r\n   \r\n\r\n    try {document.tippy.show();} catch(e){}\r\n\r\n      try\r\n      {\r\n     // document.tippy.popperInstance.scheduleUpdate();\r\n      //document.tippy.popperInstance.update();\r\n      }\r\n      catch(e)\r\n      {}\r\n\r\n    \r\n     \r\n    }\r\n    catch(e){} \r\n   \r\n   \r\n    \r\n}\r\n\r\n\r\n destroyTippy()\r\n{\r\n \r\n  try {document.tippy.hide();} catch(e){}\r\n \r\n}\r\n\r\n\r\n\r\n\r\nfitCameraToCenteredObject (object ) {\r\n \r\n  var camera=this.camera;\r\n  var offset=1;\r\n  var orbitControls=this.orbitControls;\r\n\r\n  const boundingBox = new Box3();\r\n  boundingBox.setFromObject( object );\r\n\r\n  var middle = new Vector3();\r\n  var size = new Vector3();\r\n  boundingBox.getSize(size);\r\n\r\n  // figure out how to fit the box in the view:\r\n  // 1. figure out horizontal FOV (on non-1.0 aspects)\r\n  // 2. figure out distance from the object in X and Y planes\r\n  // 3. select the max distance (to fit both sides in)\r\n  //\r\n  // The reason is as follows:\r\n  //\r\n  // Imagine a bounding box (BB) is centered at (0,0,0).\r\n  // Camera has vertical FOV (camera.fov) and horizontal FOV\r\n  // (camera.fov scaled by aspect, see fovh below)\r\n  //\r\n  // Therefore if you want to put the entire object into the field of view,\r\n  // you have to compute the distance as: z/2 (half of Z size of the BB\r\n  // protruding towards us) plus for both X and Y size of BB you have to\r\n  // figure out the distance created by the appropriate FOV.\r\n  //\r\n  // The FOV is always a triangle:\r\n  //\r\n  //  (size/2)\r\n  // +--------+\r\n  // |       /\r\n  // |      /\r\n  // |     /\r\n  // | F /\r\n  // |   /\r\n  // |  /\r\n  // | /\r\n  // |/\r\n  //\r\n  // F is half of respective FOV, so to compute the distance (the length\r\n  // of the straight line) one has to: `size/2 / Math.tan(F)`.\r\n  //\r\n  // FTR, from https://threejs.org/docs/#api/en/cameras/PerspectiveCamera\r\n  // the camera.fov is the vertical FOV.\r\n\r\n  const fov = camera.fov * ( Math.PI / 180 );\r\n  const fovh = 2*Math.atan(Math.tan(fov/2) * camera.aspect);\r\n  let dx = size.z / 2 + Math.abs( size.x / 2 / Math.tan( fovh / 2 ) );\r\n  let dy = size.z / 2 + Math.abs( size.y / 2 / Math.tan( fov / 2 ) );\r\n  let cameraZ = Math.max(dx, dy);\r\n\r\n  // offset the camera, if desired (to avoid filling the whole canvas)\r\n  if( offset !== undefined && offset !== 0 ) cameraZ *= offset;\r\n\r\n  camera.position.set( 0, 0, cameraZ );\r\n\r\n  // set the far plane of the camera so that it easily encompasses the whole object\r\n  const minZ = boundingBox.min.z;\r\n  const cameraToFarEdge = ( minZ < 0 ) ? -minZ + cameraZ : cameraZ - minZ;\r\n\r\n  camera.far = cameraToFarEdge * 3;\r\n  camera.updateProjectionMatrix();\r\n\r\n  if ( orbitControls !== undefined ) {\r\n      // set camera to rotate around the center\r\n      orbitControls.target = new Vector3(0, 0, 0);\r\n\r\n      // prevent camera from zooming out far enough to create far plane cutoff\r\n      orbitControls.maxDistance = cameraToFarEdge * 2;\r\n  }\r\n};\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n}\r\n\r\nexport default ThreeJSViewer\r\n","import React, {useRef, Component } from 'react'\r\n //trheejs version\r\nimport {Color,Mesh,BufferGeometry,PointLight, Vector2,Raycaster,MeshToonMaterial, MeshPhongMaterial,MeshLambertMaterial,SpotLight,AmbientLight, AxesHelper, DirectionalLight, GridHelper, PerspectiveCamera, Scene, WebGLRenderer,Object3D } from \"three\";\r\nimport { GLTFLoader } from 'three/examples/jsm/loaders/GLTFLoader'\r\nimport { OrbitControls } from \"three/examples/jsm/controls/OrbitControls\";\r\n\r\nimport { IFCLoader  } from \"web-ifc-three/IFCLoader\";\r\n\r\nimport IFCDB from './IFCDB';\r\n\r\nimport styles from './BBThreeJSViewer.module.css'\r\nimport ThreeJSViewer from './ThreeJSViewer';\r\n\r\nimport PublishUtils from '../../../../helpers/PublishUtils';\r\n\r\nimport gearWhite from '../../../../images/gear-white.svg'\r\nimport gearBlue from '../../../../images/gear-blue.svg'\r\nimport { connect } from \"react-redux\"\r\n\r\n\r\n\r\n\r\n//import { acceleratedRaycast, computeBoundsTree, disposeBoundsTree } from \"three-mesh-bvh\";\r\n\r\n\r\n\r\n\r\nclass BBThreeJSViewer extends Component \r\n{\r\nstatic idN=0;\r\n    \r\n    ifcdb=new IFCDB();\r\n    viewer=null;\r\n  \r\n   canvasDiv = React.createRef();\r\n    onResize=() => {\r\n      // on resize logic\r\n      console.log(\"resized\");\r\n    }\r\n\r\n\r\n    /*constructor(props)\r\n    {\r\n      super(props);\r\n    \r\n    }\r\n    */\r\n    \r\n    resize=()=>\r\n    {\r\n      console.log(\"resize event\");\r\n\r\n\r\n     \r\n\r\n\r\n    }\r\n\r\n    \r\n   \r\n      componentDidMount() \r\n    {\r\n     \r\n      const currentCanvasDiv = this.canvasDiv.current;\r\n     var me=this;\r\n      var resizeObserver = new ResizeObserver((entries) => {\r\n      try\r\n      {\r\n         me.viewer.resize();\r\n      }\r\n      catch(e){}\r\n\r\n      });\r\n      resizeObserver.observe(currentCanvasDiv);\r\n\r\n\r\n     // const element = this.ref.current;\r\n     // element.addEventListener('resize', (event) => console.log(event.detail));\r\n              this.viewer=new ThreeJSViewer();\r\n               this.viewer.initViewer(this);\r\n                this.ready();\r\n               // this.ifcLoader = new IFCLoader();\r\n\r\n              //  var o=this.ifcLoader.ifcManager.setWasmPath(\"../../bb/wasm/\").then(function(){me.ready();});\r\n    }\r\n\r\n\r\n\r\n\r\n    ready()\r\n    {\r\n      this.processSparqlResults=false;\r\n      this.updateRender();\r\n\r\n      \r\n    }\r\n\r\n\r\n    getGLBFilesFromProps(props)\r\n    {\r\n      var prefix =props[\"glb files prefix\"];\r\n      if (prefix==null)prefix=\"\";\r\n      var files = props[\"glb files\"];\r\n      var files2=[];\r\n      if (files!=null)\r\n      {\r\n        for (var n in files)\r\n        {\r\n          var file=files[n];\r\n        \r\n          var file2=PublishUtils.processStringForParameters({props:props},file);\r\n\r\n          if (file2!=null)\r\n          {\r\n            var files22= file2.split(\",\");\r\n            for (var nn in files22)\r\n            {\r\n              var file3 = files22[nn];\r\n              file3=file3.replace(\"\\\"\",\"\").replace(\"\\\"\",\"\").replace(\"<\",\"\").replace(\">\",\"\").replace(\"\\\\\\\"\",\"\").replace(\"\\\\\\\"\",\"\");\r\n              if (file3.length>4)\r\n              {\r\n                files2.push(prefix+file3);\r\n              }\r\n            }\r\n          }\r\n          \r\n        }\r\n      }\r\n      return files2;\r\n    }\r\n\r\n\r\n    shouldComponentUpdate(props,state)\r\n    {\r\n        //no unless\r\n       \r\n        try\r\n        {\r\n          var a1=this.getGLBFilesFromProps(this.props);\r\n          var a2=this.getGLBFilesFromProps(props);\r\n          if (JSON.stringify(a1)!=JSON.stringify(a2)) return true;\r\n        }\r\n        catch(e) {}\r\n\r\n        try\r\n        {\r\n           if (this.props.data!=props.data) \r\n           {\r\n          //  console.log(\"data change so update is necessary \");\r\n            return true;\r\n           }\r\n        }\r\n        catch(e) {}\r\n\r\n        try{\r\n        var sel = this.props.guidselector;\r\n        var sel2 = this.props.pubsub[sel];\r\n\r\n        var sela = props.guidselector;\r\n        var sela2 = props.pubsub[sela];\r\n        if (sela2!=sel2) return true;\r\n      }\r\n      catch(e) {}\r\n   \r\n\r\n    \r\n       return false;\r\n\r\n    }\r\n\r\n   \r\n\r\n\r\n    loadTestIFC() {\r\n\r\n      var me=this;\r\nvar files=[];\r\nfiles.push(\"SITE_HOW.ifc\");\r\nif (false)\r\n{\r\nfiles.push(\"SITE_HOW_CTRAY.ifc\");\r\nfiles.push(\"SITE_HOW_EQUIPMENT.ifc\");\r\nfiles.push(\"SITE_HOW_EQUIPMENT2.ifc\");\r\nfiles.push(\"SITE_HOW_EXTRAS_HOA.ifc\");\r\nfiles.push(\"SITE_HOW_HVAC.ifc\");\r\nfiles.push(\"SITE_HOW_PENETRATIONS.ifc\");\r\nfiles.push(\"SITE_HOW_PIPING.ifc\");\r\n}\r\n\r\nif (false)\r\n{\r\n\r\nfiles.push(\"SITE_HOW_STRUCTURE.ifc\");\r\nfiles.push(\"SITE_HOW_STRUCTURE1.ifc\");\r\nfiles.push(\"SITE_HOW_STRUCTURE2.ifc\");\r\nfiles.push(\"SITE_HOW_STRUCTURE3.ifc\");\r\nfiles.push(\"SITE_HOW_STRUCTURE4.ifc\");\r\n}\r\n\r\n\r\n\r\n\r\n\r\nfor (var n in files)\r\n{\r\n    var file= files[n];\r\n     me.loadIFC(\"http://localhost:3000/temp/\"+file);\r\n}\r\n   \r\n\r\n//});\r\n}\r\n\r\nloadIFC(file)\r\n{\r\n    var me=this;\r\n    \r\n  //  console.log(file);\r\n\r\n  \r\n    this.ifcLoader.load(file, (ifcModel) => me.scene.add(ifcModel));\r\n}\r\n\r\n\r\n\r\nupdateRender(force)\r\n{\r\n \r\n  if (this.viewer!=null)\r\n  {\r\n      if ( (this.viewer.renderer!=null) && (this.processSparqlResults) )\r\n      {\r\n       \r\n        this.ifcdb.processSparqlResults(this);\r\n      }\r\n      else\r\n      {\r\n        if (this.viewer.renderer!=null) \r\n        {\r\n          var files2=this.getGLBFilesFromProps(this.props);\r\n          if (this.isEmpty(files2))\r\n            {\r\n             \r\n              if (!this.ifcdb.isEmpty())\r\n              {\r\n               \r\n                this.viewer.controls.enabled=false;\r\n                this.ifcdb.setVisible(false);\r\n                this.ifcdb.emptyScene();\r\n               \r\n                this.ifcdb.processedAll();\r\n\r\n                \r\n              }\r\n             // console.log(\"returning \");\r\n              return;\r\n            }\r\n          \r\n          if ((force) || (this.ifcdb.shouldLoadNewFiles(files2)))\r\n          {\r\n            this.viewer.controls.enabled=false;\r\n            this.props.setLoading(true);\r\n             \r\n            this.ifcdb.loadGLBFiles(this,files2);\r\n           // console.log(\"returning 2\");\r\n            return;\r\n          }\r\n\r\n          if (this.ifcdb.ifcdbsparql.needsUpdate())\r\n          {\r\n            this.viewer.controls.enabled=false;\r\n            this.props.setLoading(true);\r\n          //  console.log(\"triggered setSparql update\");\r\n            this.ifcdb.processedAll(true); // reuse pickgroup if possible\r\n             return;\r\n          }\r\n          if (this.props.guidselector!=null)\r\n          {\r\n            this.viewer.setSelectedGuid();\r\n            \r\n          }\r\n          \r\n\r\n         \r\n        }\r\n        //console.log(\"no sparql results \");\r\n      }\r\n}\r\n}\r\n\r\nisEmpty(files)\r\n{\r\n  if (files==null) return true;\r\n  if (files.length==0) return true;\r\n  if (files.length==1)\r\n  {\r\n    var file =files[0];\r\n    if (file.includes(\"http://www.buildingbits.nl/reset\"))\r\n    {\r\n      return true;\r\n    }\r\n    if (file.length<3)\r\n    {\r\n      return true;\r\n    }\r\n  }\r\n  return false;\r\n\r\n \r\n               \r\n\r\n}\r\n\r\n\r\n    render() {\r\n\r\n        \r\n    \r\n      if (this.ifcdb.loadingInProgress)\r\n      {\r\n            console.log(\"input changed. we might have to check because loading is true\");\r\n            this.ifcdb.inputChanged=true;\r\n      }\r\n      else\r\n      {\r\n        this.updateRender();\r\n      }\r\n      if (this.id==null)\r\n      {\r\n          BBThreeJSViewer.idN++;\r\n        this.id=\"id\"+BBThreeJSViewer.idN;\r\n      }\r\n\r\n    \r\n      const tippyID=\"tippydiv\"+this.id;\r\n      const tcid=\"three-canvas\"+this.id;\r\n      const legendID=\"legenddiv\"+this.id;\r\n      \r\n        return (\r\n          \r\n          <div ref={this.canvasDiv} id={tippyID} className={styles.fullWidget} >\r\n           <div   className={ styles.right}>\r\n                <img \r\n                    src={gearWhite}\r\n                    alt=\"gear\"\r\n                  \r\n                    onClick={() => this.setState({ dialogVisible: true })}\r\n                  />\r\n            </div>\r\n\r\n           \r\n           \r\n         \r\n            <canvas   className={styles.fullWidget} style={{position: \"relative\"}} id={tcid}>\r\n\r\n\r\n      \r\n            </canvas>\r\n            </div>\r\n        )\r\n      }\r\n\r\n\r\n      \r\n}\r\n\r\nexport default connect()(BBThreeJSViewer)\r\n"],"sourceRoot":""}